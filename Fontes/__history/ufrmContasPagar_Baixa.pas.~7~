unit ufrmContasPagar_Baixa;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseEdicao, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS,
  FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt,
  Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, Vcl.ComCtrls, uBiblioteca, uTipos;

type
  TfrmContasPagar_Baixa = class(TfrmBaseEdicao)
    pnl_id_transacao: TPanel;
    Label1: TLabel;
    edt_ID: TPanel;
    GroupBox1: TGroupBox;
    lbl_nome_pessoa: TLabel;
    Label2: TLabel;
    lbl_saldo_aberto: TLabel;
    rg_forma_pagto: TRadioGroup;
    Label3: TLabel;
    Label4: TLabel;
    Label6: TLabel;
    edt_valor: TEdit;
    dtp_data: TDateTimePicker;
    mm_historico: TMemo;
    procedure FormCreate(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    Fp_nome_pessoa: string;
    Fp_conta_receber_id: integer;
    Fp_saldo_aberto: double;
    Fp_tabela: string;
  protected
    procedure prc_componentes;
    procedure prc_inicializar;
    procedure prc_ler_dados;
    function fnc_validar:boolean;

  public
    property p_conta_pagar_id: integer read Fp_conta_receber_id write Fp_conta_receber_id;
    property p_nome_pessoa: string read Fp_nome_pessoa write Fp_nome_pessoa;
    property p_saldo_aberto: double read Fp_saldo_aberto write Fp_saldo_aberto;

    property p_tabela: string read Fp_tabela write Fp_tabela;

  end;

procedure executa(conta_pagar_id: integer; nome_pessoa: string; saldo_aberto: double);

implementation

{$R *.dfm}

procedure executa(conta_pagar_id: integer; nome_pessoa: string; saldo_aberto: double);
var
 loForm : TfrmContasPagar_Baixa;
begin
  loForm := TfrmContasPagar_Baixa.Create(Application);
  // carregar as propriedades
  loForm.p_conta_pagar_id := conta_pagar_id;
  loForm.p_nome_pessoa   := nome_pessoa;
  loForm.p_saldo_aberto   := saldo_aberto;

  try
    loForm.ShowModal;
  finally
     FreeAndNil(loForm);
  end;
end;


function TfrmContasPagar_Baixa.fnc_validar: boolean;
begin
  result := false;
  if dtp_data.Date < date then
  begin
    ShowMessage('informe uma DATA VÁLIDA');
    if dtp_data.CanFocus then dtp_data.SetFocus;
    exit;
  end;

  if StrToFloatDef(edt_valor.Text,0) <= 0 then
  begin
    ShowMessage('informe uma valor válido');
    if edt_valor.CanFocus then edt_valor.SetFocus;
    exit;
  end;

  if (StrToFloatDef(edt_valor.Text,0) - p_saldo_aberto) >= 0.01 then
  begin
    ShowMessage('Valor digitado é maior que o saldo devedor do fornecedor');
    if edt_valor.CanFocus then edValor.SetFocus;
    exit;
  end;


  if rg_forma_pagto.ItemIndex = -1 then
  begin
    ShowMessage('informe a forma de pagamento');
    if rg_forma_pagto.CanFocus then rg_forma_pagto.SetFocus;
    exit;
  end;


  if mm_historico.Lines.text = '' then
  begin
    ShowMessage('Descreva como foi o pagamento');
    if mm_historico.CanFocus then mm_historico.SetFocus;
    exit;
  end;

  result := true;

end;

procedure TfrmContasPagar_Baixa.FormCreate(Sender: TObject);
begin
  inherited;
  p_tabela := 'CONTAS_PAGAR_BAIXA';
  titulo   := 'Baixar conta a pagar';

end;

procedure TfrmContasPagar_Baixa.FormShow(Sender: TObject);
begin
  inherited;
  prc_componentes;
  prc_inicializar;

end;

procedure TfrmContasPagar_Baixa.prc_componentes;
begin
  edt_ID.Caption := '-1';
  dtp_data.Date  := Date;

  qry.Connection := Conexao;
  qry.SQL.Add('select * from ' + p_tabela + ' where ID =:ID');


end;

procedure TfrmContasPagar_Baixa.prc_inicializar;
begin
   prc_ler_dados;

end;

procedure TfrmContasPagar_Baixa.prc_ler_dados;
begin
  lbl_nome_pessoa.Caption := p_nome_pessoa;
  lbl_saldo_aberto.Caption := formatFloat('R$ 0.00',p_saldo_aberto);



end;

end.
