//***************************************************************************//
// Cadastro de Fornecedores (base ufrmPlanoContas)
// desenvolvida por Jocelio G Silva
// inicio : 22/02/2024  Deus seja louvado.
// fim :
//***************************************************************************//

unit ufrmFornecedores;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseGrade, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, System.Actions, Vcl.ActnList,
  System.ImageList, Vcl.ImgList, Vcl.Menus, FireDAC.Comp.DataSet,
  FireDAC.Comp.Client, Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls, Vcl.ComCtrls,
  Vcl.DBCtrls, Vcl.ToolWin, Vcl.StdCtrls, Vcl.Buttons, uBiblioteca,
  ufrmFornecedoresE, unit_principal, udmConn;

type
  TfrmFornecedores = class(TfrmBaseGrade)
    qryID: TIntegerField;
    qryNOME: TStringField;
    qryCPF_CNPJ: TStringField;
    qryCONTATOS: TStringField;
    qryTELEFONES_CONTATO: TStringField;
    qryPRODUTOS: TStringField;
    qryATIVO: TStringField;

    procedure FormCreate(Sender: TObject);
    procedure FormClose(Sender: TObject; var Action: TCloseAction);

    procedure actIncluirExecute(Sender: TObject);
    procedure actAlterarExecute(Sender: TObject);
    procedure actExcluirExecute(Sender: TObject);

  private
    procedure prc_sql;

  public
    { Public declarations }
  end;
var
 loForm : TfrmFornecedores;

procedure prc_executa;

implementation

uses unit_funcoes;

procedure prc_executa;

begin

  if loForm = nil then
  begin
    loForm := TfrmFornecedores.Create(Application);
    form_principal.prc_controla_menu(false);

    // se abrir dentro no painel principal não funciona os edites :(
    //loform.Parent := form_principal.pnl_principal;

    loform.top    :=  form_principal.pnl_Principal.Top;
    loform.Left   := form_principal.pnl_menulateral.Width;

    loForm.Width  := form_principal.pnl_principal.Width;
    loForm.Height := form_principal.pnl_principal.Height;
  end;
  loForm.Show;

end;

{$R *.dfm}



procedure TfrmFornecedores.actAlterarExecute(Sender: TObject);
var
  id : integer;
begin
  inherited;
  id := qry.fieldbyname('ID').AsInteger;
  ufrmFornecedoresE.prc_alterar(id);
  uBiblioteca.AtualizaQuery(qry);

  qry.Locate('ID', id, []);

  //ajustas as colunas do dbgrid
  prc_ajustar_colunas_grid( DBGrid1 );

  //aumenta o tamanho da linha do ddgrid
  prc_ajusta_tamanho_linha( DBGrid1 );

end;

procedure TfrmFornecedores.actExcluirExecute(Sender: TObject);
begin
  inherited;
  ufrmFornecedoresE.prc_excluir(qry.fieldbyname('ID').AsInteger);
  uBiblioteca.AtualizaQuery(qry);

  //ajustas as colunas do dbgrid
  prc_ajustar_colunas_grid( DBGrid1 );

  //aumenta o tamanho da linha do ddgrid
  prc_ajusta_tamanho_linha( DBGrid1 );


end;

procedure TfrmFornecedores.actIncluirExecute(Sender: TObject);
begin
  inherited;
  ufrmFornecedoresE.prc_incluir;
  uBiblioteca.AtualizaQuery(qry);

  //ajustas as colunas do dbgrid
  prc_ajustar_colunas_grid( DBGrid1 );

  //aumenta o tamanho da linha do ddgrid
  prc_ajusta_tamanho_linha( DBGrid1 );


end;

procedure TfrmFornecedores.FormClose(Sender: TObject; var Action: TCloseAction);
begin
  inherited;

  form_principal.prc_controla_menu(true);
  FreeAndNil(loForm);


end;

procedure TfrmFornecedores.FormCreate(Sender: TObject);
begin

  self.Tabela := 'FORNECEDORES';
  prc_sql;

   inherited;
end;


procedure TfrmFornecedores.prc_sql;
begin
  qry.SQL.Clear;
  sSql :=  ' select ' +
           '   F.ID, P.NOME, P.CPF_CNPJ, F.CONTATOS, F.TELEFONES_CONTATO, F.PRODUTOS, F.ATIVO ' +
           ' from  ' +
           '   PESSOAS P, FORNECEDORES F ' +
           ' where ' +
           '   P.ID = F.PESSOA_ID ';

  QRY.SQL.Clear;
  qry.sql.add(sSql);

end;

end.
