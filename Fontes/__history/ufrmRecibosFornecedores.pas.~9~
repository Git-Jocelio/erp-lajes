unit ufrmRecibosFornecedores;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseGrade, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, System.Actions, Vcl.ActnList,
  System.ImageList, Vcl.ImgList, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  Vcl.Buttons, Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.ToolWin,
  Vcl.StdCtrls, udmConn, frxClass, frxExportBaseDialog, frxExportPDF, frxDBSet;

type
  TfrmRecibosFornecedores = class(TfrmBaseGrade)
    qryID: TIntegerField;
    qryCADASTRADO_EM: TDateField;
    qryVALOR: TFMTBCDField;
    qryPESSOA_ID: TIntegerField;
    qryUSUARIO_ID: TIntegerField;
    qryOBSERVACAO: TStringField;
    frxPDFExport1: TfrxPDFExport;
    qry_dinheiro: TFDQuery;
    qry_dinheiroID: TIntegerField;
    qry_dinheiroRECIBO_ID: TIntegerField;
    qry_dinheiroVALOR: TFMTBCDField;
    qry_dinheiroOBSERVACAO: TStringField;
    qry_pix: TFDQuery;
    qry_pixID: TIntegerField;
    qry_pixRECIBO_ID: TIntegerField;
    qry_pixVALOR: TFMTBCDField;
    qry_pixOBSERVACAO: TStringField;
    qry_cheque: TFDQuery;
    qry_chequeID: TIntegerField;
    qry_chequeRECIBO_ID: TIntegerField;
    qry_chequeBANCO: TStringField;
    qry_chequeAGENCIA: TStringField;
    qry_chequeNR_CONTA: TStringField;
    qry_chequeNR_CHEQUE: TStringField;
    qry_chequeVALOR: TFMTBCDField;
    qry_chequeHISTORICO: TStringField;
    frxDBDinheiro: TfrxDBDataset;
    frxDBpix: TfrxDBDataset;
    frxDBCheque: TfrxDBDataset;
    qry_contas_pagar: TFDQuery;
    qry_contas_pagarID: TIntegerField;
    qry_contas_pagarRECIBO_ID: TIntegerField;
    qry_contas_pagarCONTAS_PAGAR_ID: TIntegerField;
    qry_contas_pagarHISTORICO: TStringField;
    qry_contas_pagarVALOR_PARCELA: TFMTBCDField;
    qry_contas_pagarBAIXAR: TFMTBCDField;
    qry_contas_receber: TFDQuery;
    qry_contas_receberID: TIntegerField;
    qry_contas_receberRECIBO_ID: TIntegerField;
    qry_contas_receberCONTAS_RECEBER_ID: TIntegerField;
    qry_contas_receberHISTORICO: TStringField;
    qry_contas_receberVALOR_PARCELA: TFMTBCDField;
    qry_contas_receberBAIXAR: TFMTBCDField;
    qry_empresa: TFDQuery;
    qry_empresaNOME: TStringField;
    qry_empresaCPF_CNPJ: TStringField;
    qry_empresaIMG_LOGO: TStringField;
    frxDBContasPagar: TfrxDBDataset;
    frxDBPedidos: TfrxDBDataset;
    frxDBEmpresa: TfrxDBDataset;
    frxReportReciboPagto: TfrxReport;
    frxDBReciboPagto: TfrxDBDataset;
    qryVALOR_EXTENSO: TStringField;
    qryNOME: TStringField;
    procedure actIncluirExecute(Sender: TObject);
    procedure actAlterarExecute(Sender: TObject);
    procedure actImprimirExecute(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmRecibosFornecedores: TfrmRecibosFornecedores;

implementation

{$R *.dfm}

uses ufrmRecibosFornecedoresE, uTipos;

procedure TfrmRecibosFornecedores.actAlterarExecute(Sender: TObject);
begin
  inherited;
  try
    if frmRecibosFornecedoresE = nil then
      frmRecibosFornecedoresE := TfrmRecibosFornecedoresE.Create(application);

    frmRecibosFornecedoresE.p_operacao := utipos.opAlterar;
    frmRecibosFornecedoresE.codigo     := qry.FieldByName('ID').AsInteger;
    frmRecibosFornecedoresE.ShowModal;

  finally
    freeandnil(frmRecibosFornecedoresE);
  end;
end;

procedure TfrmRecibosFornecedores.actImprimirExecute(Sender: TObject);
begin
  inherited;
  // busca entrada em dinheiro
  qry_dinheiro.Close;
  qry_dinheiro.parambyname('recibo_id').AsInteger := qry.FieldByName('id').AsInteger;
  qry_dinheiro.Open;

  // busca entrada em dinheiro
  qry_pix.Close;
  qry_pix.parambyname('recibo_id').AsInteger := qry.FieldByName('id').AsInteger;
  qry_pix.Open;

  // busca entrada em CHEQUE
  qry_cheque.Close;
  qry_cheque.parambyname('recibo_id').AsInteger := qry.FieldByName('id').AsInteger;
  qry_cheque.Open;

  // busca entrada em CONTAS_PAGAR
  qry_contas_pagar.Close;
  qry_contas_pagar.parambyname('recibo_id').AsInteger := qry.FieldByName('id').AsInteger;
  qry_contas_pagar.Open;

  // busca entrada em CONTAS_RECEBER
  qry_contas_receber.Close;
  qry_contas_receber.parambyname('recibo_id').AsInteger := qry.FieldByName('id').AsInteger;
  qry_contas_receber.Open;

  qry_empresa.Open;

  frxReportReciboPagto.ShowReport;

end;

procedure TfrmRecibosFornecedores.actIncluirExecute(Sender: TObject);
begin
  inherited;
  try
    if frmRecibosFornecedoresE = nil then
      frmRecibosFornecedoresE := TfrmRecibosFornecedoresE.Create(application);

    frmRecibosFornecedoresE.p_operacao := utipos.OpIncluir;
    frmRecibosFornecedoresE.codigo     := -1;
    frmRecibosFornecedoresE.ShowModal;

  finally
    freeandnil(frmRecibosFornecedoresE);
  end;
end;

end.
