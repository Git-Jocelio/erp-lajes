unit ufrmComissaoFechamento_Alt_Valor;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseEdicao, FireDAC.Stan.Intf,
  FireDAC.Stan.Option, FireDAC.Stan.Param, FireDAC.Stan.Error, FireDAC.DatS,
  FireDAC.Phys.Intf, FireDAC.DApt.Intf, FireDAC.Stan.Async, FireDAC.DApt,
  Data.DB, FireDAC.Comp.DataSet, FireDAC.Comp.Client, Vcl.StdCtrls, Vcl.Buttons,
  Vcl.ExtCtrls, uTipos;

type
  TfrmComissaoFechamento_Alt_Valor = class(TfrmBaseEdicao)
    Label1: TLabel;
    Label2: TLabel;
    Label3: TLabel;
    lbl_data: TLabel;
    edt_pagar: TEdit;
    edt_historico: TEdit;
    label300: TLabel;
    lbl_pedido: TLabel;
    Label5: TLabel;
    lbl_cliente: TLabel;
    Label6: TLabel;
    lbl_bairro: TLabel;
    Label7: TLabel;
    lbl_venda: TLabel;
    Label8: TLabel;
    lbl_comissao: TLabel;

    procedure FormShow(Sender: TObject);
    procedure FormCreate(Sender: TObject);

  private
    Fp_valor_venda: double;
    Fp_data: TDate;
    Fp_nosso_numero: string;
    Fp_historico: string;
    Fp_nm_bairro: string;
    Fp_nm_cliente: string;
    Fp_valor_comissao: double;
    Fp_valor_pago: double;
    Fp_ID: integer;
    FOperacao: uTipos.TOperacao;
  protected
    function fnc_validar: boolean;
    function fnc_alterar : Boolean;

    // conf as propridades dos componestes
    procedure prc_componentes;
    procedure prc_inicializar;
    procedure prc_ler_dados;

  public

    property Operacao : uTipos.TOperacao read FOperacao write FOperacao;

    property p_ID: integer read Fp_ID write Fp_ID;
    property p_data: TDate read Fp_data write Fp_data;
    property p_nosso_numero: string read Fp_nosso_numero write Fp_nosso_numero;
    property p_nm_cliente: string read Fp_nm_cliente write Fp_nm_cliente;
    property p_nm_bairro: string read Fp_nm_bairro write Fp_nm_bairro;
    property p_valor_venda: double read Fp_valor_venda write Fp_valor_venda;
    property p_valor_comissao: double read Fp_valor_comissao write Fp_valor_comissao;
    property p_valor_pago: double read Fp_valor_pago write Fp_valor_pago;
    property p_historico: string read Fp_historico write Fp_historico;

  end;

  procedure prc_alterar(AID: integer; Adata: TDate;Anosso_numero,Anm_cliente,
                        Anm_bairro: string; Avalor_venda,Avalor_comissao,
                        Avalor_pago: double;Ahistorico:string);

implementation

procedure prc_alterar( AID: integer; Adata: TDate; Anosso_numero, Anm_cliente,
                       Anm_bairro: string; Avalor_venda, Avalor_comissao,
                       Avalor_pago: double; Ahistorico:string );
var
  loForm : TfrmComissaoFechamento_Alt_Valor;
begin
  try
    loForm := TfrmComissaoFechamento_Alt_Valor.Create(Application);

    loForm.Operacao         := uTipos.opAlterar;
    loForm.p_ID             := AID;
    loForm.p_data           := Adata;
    loForm.p_nosso_numero   := Anosso_numero;
    loForm.p_nm_cliente     := Anm_cliente;
    loForm.p_nm_bairro      := Anm_bairro;
    loForm.p_valor_venda    := Avalor_venda;
    loForm.p_valor_comissao := Avalor_comissao;
    loForm.p_valor_pago     := Avalor_pago;
    loForm.p_historico      := Ahistorico;

    loForm.ShowModal;

  finally
    FreeAndNil(loForm);
  end;

end;


{$R *.dfm}

{ TfrmComissaoFechamento_Alt_Valor }

function TfrmComissaoFechamento_Alt_Valor.fnc_alterar: Boolean;
begin

end;

function TfrmComissaoFechamento_Alt_Valor.fnc_validar: boolean;
begin
  result := false;

  if ( (StrToFloatDef(edt_pagar.Text,0) <= 0) or
       (StrToFloatDef(edt_pagar.Text,0) > p_valor_comissao) )
  then
  begin
    ShowMessage('Informe um VALOR válido');
    edt_pagar.SetFocus;
    exit;
  end;


  {validou, atualizar as propriedades}
  p_valor_pago := StrToFloatDef(edt_pagar.Text,0);
  p_historico  := edt_historico.Text;


  result := true;

end;

procedure TfrmComissaoFechamento_Alt_Valor.FormCreate(Sender: TObject);
begin
  inherited;
  titulo := 'Alteração do valor pago';

end;

procedure TfrmComissaoFechamento_Alt_Valor.FormShow(Sender: TObject);
begin
  inherited;
  prc_componentes;
  prc_inicializar;

end;

procedure TfrmComissaoFechamento_Alt_Valor.prc_componentes;
begin
  lbl_sub_titulo.Caption := 'Aqui você pode alterar valor a ser pago de uma comissão especifica.' ;

end;

procedure TfrmComissaoFechamento_Alt_Valor.prc_inicializar;
begin
  case self.Operacao of

  uTipos.opAlterar: begin
                      self.prc_ler_dados;
                      lbl_titulo.Caption  := titulo + ' [Alteração]';
                      btnOk.Caption := 'Alterar';
                    end;
  else
    begin
      pnDados.Enabled := false;
      if btnFechar.CanFocus then btnFechar.SetFocus;
    end;
  end;

end;

procedure TfrmComissaoFechamento_Alt_Valor.prc_ler_dados;
begin

  lbl_data.Caption     := datetostr( p_data );
  lbl_pedido.Caption   := p_nosso_numero ;
  lbl_cliente.Caption  := p_nm_cliente;
  lbl_bairro.Caption   := p_nm_bairro;
  lbl_venda.Caption    := formatfloat('0.00', p_valor_venda);
  lbl_comissao.Caption := formatfloat('0.00', p_valor_comissao);
  edt_pagar.Text       := formatfloat('0.00', p_valor_comissao);
  edt_historico.Text   := p_historico;

end;

end.
