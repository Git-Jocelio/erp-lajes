unit ufrmProducaoTelas;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseGrade, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, System.Actions, Vcl.ActnList,
  System.ImageList, Vcl.ImgList, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  Vcl.Buttons, Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.ToolWin,
  Vcl.StdCtrls, udmConn, ufrmProducaoTelasE, uBiblioteca, uTipos;

type
  TfrmProducaoTelas = class(TfrmBaseGrade)
    Label1: TLabel;
    dtp_data_ini: TDateTimePicker;
    dtp_data_fim: TDateTimePicker;
    qryID: TIntegerField;
    qryCADASTRADO_EM: TDateField;
    qryACO_ID: TIntegerField;
    qryQTDE_ACO_UTILIZADO: TFMTBCDField;
    qryQTDE_TELAS_PRODUZIDAS: TIntegerField;
    qryCONSUMO_POR_TELA: TFMTBCDField;
    qryTIPOS_TELA: TSmallintField;
    qryNOME_FANTASIA: TStringField;
    procedure FormCreate(Sender: TObject);
    procedure actIncluirExecute(Sender: TObject);
    procedure actAlterarExecute(Sender: TObject);
    procedure actExcluirExecute(Sender: TObject);
    procedure actLocalizarExecute(Sender: TObject);
  private
    procedure prc_sql;
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmProducaoTelas: TfrmProducaoTelas;



implementation




{$R *.dfm}

procedure TfrmProducaoTelas.actAlterarExecute(Sender: TObject);
var
  id : integer;
begin
  if DBGrid1.DataSource.DataSet.IsEmpty then exit;

  id := qry.fieldbyname('ID').AsInteger;
  ufrmProducaoTelasE.prc_alterar(id);

  uBiblioteca.AtualizaQuery(qry);
  qry.Locate('ID', id, []);

  inherited;
end;

procedure TfrmProducaoTelas.actExcluirExecute(Sender: TObject);
begin
  ufrmProducaoTelasE.prc_excluir(qry.fieldbyname('ID').AsInteger);
  uBiblioteca.AtualizaQuery(qry);
  inherited;
end;

procedure TfrmProducaoTelas.actIncluirExecute(Sender: TObject);
begin
  ufrmProducaoTelasE.prc_incluir;
  uBiblioteca.AtualizaQuery(qry);

  inherited;
end;

procedure TfrmProducaoTelas.actLocalizarExecute(Sender: TObject);
var
  condicao : string;
begin

  condicao := ssql + ' and CADASTRADO_EM >= :DATA_INI and CADASTRADO_EM <= :DATA_FIM';
  QRY.SQl.Clear;
  qry.SQL.Add(condicao);
  qry.ParamByName('DATA_INI').AsDate := dtp_data_ini.Date;
  qry.ParamByName('DATA_FIM').AsDate := dtp_data_fim.Date;
  //showmessage(qry.SQL.Text);
  qry.Open;

end;

procedure TfrmProducaoTelas.FormCreate(Sender: TObject);
begin
  dtp_data_ini.Date := date;
  dtp_data_fim.Date := date;

  self.Tabela := 'PRODUCAO_TELAS';
  prc_sql;

  DBGrid1.Columns[2].Visible := false;

  inherited;
end;

procedure TfrmProducaoTelas.prc_sql;
begin

  sSql :=
          'select                       ' +
          '    P.ID,                    ' +
          '    P.CADASTRADO_EM,         ' +
          '    P.ACO_ID,                ' +
          '    PR.NOME_FANTASIA,        ' +
          '    P.QTDE_ACO_UTILIZADO,    ' +
          '    P.QTDE_TELAS_PRODUZIDAS, ' +
          '    P.CONSUMO_POR_TELA,      ' +
          '    P.TIPOS_TELA             ' +
          'from                         ' +
          '  PRODUCAO_TELAS P,          ' +
          '  PRODUTOS PR                ' +
          'where  PR.ID = P.ACO_ID      ';
  qry.sql.Clear;
  qry.sql.Add(sSql);
  QRY.Open;

end;


end.
