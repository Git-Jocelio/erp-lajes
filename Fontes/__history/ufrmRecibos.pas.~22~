unit ufrmRecibos;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, ufrmBaseGrade, Data.DB,
  FireDAC.Stan.Intf, FireDAC.Stan.Option, FireDAC.Stan.Param,
  FireDAC.Stan.Error, FireDAC.DatS, FireDAC.Phys.Intf, FireDAC.DApt.Intf,
  FireDAC.Stan.Async, FireDAC.DApt, System.Actions, Vcl.ActnList,
  System.ImageList, Vcl.ImgList, FireDAC.Comp.DataSet, FireDAC.Comp.Client,
  Vcl.Buttons, Vcl.Grids, Vcl.DBGrids, Vcl.ExtCtrls, Vcl.ComCtrls, Vcl.ToolWin,
  Vcl.StdCtrls, udmConn, ufrmRecibosE, uTipos, frxClass, frxDBSet,
  frxExportBaseDialog, frxExportPDF;

type
  TfrmRecibos = class(TfrmBaseGrade)
    qryRECIBO_ID: TIntegerField;
    qryCADASTRADO_EM: TDateField;
    qryVALOR: TFMTBCDField;
    qryOBSERVACAO: TStringField;
    qryNOME: TStringField;
    frxReportRecibo: TfrxReport;
    frxDBRecibo: TfrxDBDataset;
    qry_dinheiro: TFDQuery;
    frxDBDinheiro: TfrxDBDataset;
    qry_pix: TFDQuery;
    frxDBpix: TfrxDBDataset;
    qry_cheque: TFDQuery;
    frxDBCheque: TfrxDBDataset;
    qry_chequeID: TIntegerField;
    qry_chequeRECIBO_ID: TIntegerField;
    qry_chequeBANCO: TStringField;
    qry_chequeAGENCIA: TStringField;
    qry_chequeNR_CONTA: TStringField;
    qry_chequeNR_CHEQUE: TStringField;
    qry_chequeVALOR: TFMTBCDField;
    qry_chequeHISTORICO: TStringField;
    qry_dinheiroID: TIntegerField;
    qry_dinheiroRECIBO_ID: TIntegerField;
    qry_dinheiroVALOR: TFMTBCDField;
    qry_dinheiroOBSERVACAO: TStringField;
    qry_pixID: TIntegerField;
    qry_pixRECIBO_ID: TIntegerField;
    qry_pixVALOR: TFMTBCDField;
    qry_pixOBSERVACAO: TStringField;
    qry_cartao: TFDQuery;
    frxDBCartao: TfrxDBDataset;
    qry_cartaoID: TIntegerField;
    qry_cartaoRECIBO_ID: TIntegerField;
    qry_cartaoNOME: TStringField;
    qry_cartaoDESCRICAO: TStringField;
    qry_cartaoQTDE_PARCELAS: TIntegerField;
    qry_cartaoVALOR_VENDA: TFMTBCDField;
    qry_cartaoCV: TStringField;
    qry_contas_pagar: TFDQuery;
    frxDBContasPagar: TfrxDBDataset;
    qry_contas_pagarID: TIntegerField;
    qry_contas_pagarRECIBO_ID: TIntegerField;
    qry_contas_pagarCONTAS_PAGAR_ID: TIntegerField;
    qry_contas_pagarHISTORICO: TStringField;
    qry_contas_pagarVALOR_PARCELA: TFMTBCDField;
    qry_contas_pagarBAIXAR: TFMTBCDField;
    qry_pedidos: TFDQuery;
    frxDBPedidos: TfrxDBDataset;
    qry_pedidosID: TIntegerField;
    qry_pedidosRECIBO_ID: TIntegerField;
    qry_pedidosCONTAS_RECEBER_ID: TIntegerField;
    qry_pedidosHISTORICO: TStringField;
    qry_pedidosVALOR_PARCELA: TFMTBCDField;
    qry_pedidosBAIXAR: TFMTBCDField;
    qry_empresa: TFDQuery;
    frxDBEmpresa: TfrxDBDataset;
    qry_empresaNOME: TStringField;
    qry_empresaCPF_CNPJ: TStringField;
    qryCPF_CNPJ: TStringField;
    frxPDFExport1: TfrxPDFExport;
    qryVALOR_EXTENSO: TStringField;
    qry_empresaIMG_LOGO: TStringField;
    qry_empresaENDERECO: TStringField;
    qry_empresaNUMERO: TStringField;
    qry_empresaBAIRRO: TStringField;
    qry_empresaCIDADE: TStringField;
    qry_empresaUF: TStringField;
    qry_empresaTELEFONE: TStringField;
    qry_empresaCEP: TStringField;
    frxDBImagem: TfrxDBDataset;
    qryImagemRelatorio: TFDQuery;
    procedure actIncluirExecute(Sender: TObject);
    procedure actAlterarExecute(Sender: TObject);
    procedure actImprimirExecute(Sender: TObject);
    procedure FormCreate(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  frmRecibos: TfrmRecibos;

implementation

{$R *.dfm}

procedure TfrmRecibos.actAlterarExecute(Sender: TObject);
begin
  try
    if frmRecibosE = nil then
      frmRecibosE      := TfrmRecibosE.Create(application);

    frmRecibosE.p_operacao := utipos.opAlterar;
    frmRecibosE.codigo := qry.FieldByName('RECIBO_ID').AsInteger;
    frmRecibosE.ShowModal;

  finally
    freeandnil(frmRecibosE);
  end;

end;

procedure TfrmRecibos.actImprimirExecute(Sender: TObject);
begin
  inherited;
  // busca entrada em dinheiro
  qry_dinheiro.Close;
  qry_dinheiro.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_dinheiro.Open;

  // busca entrada em dinheiro
  qry_pix.Close;
  qry_pix.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_pix.Open;

  // busca entrada em CHEQUE
  qry_cheque.Close;
  qry_cheque.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_cheque.Open;

  // busca entrada em CARTAO
  qry_cartao.Close;
  qry_cartao.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_cartao.Open;

  // busca entrada em CONTAS_PAGAR
  qry_contas_pagar.Close;
  qry_contas_pagar.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_contas_pagar.Open;

  // busca entrada em CONTAS_RECEBER
  qry_pedidos.Close;
  qry_pedidos.parambyname('recibo_id').AsInteger := qry.FieldByName('recibo_id').AsInteger;
  qry_pedidos.Open;

  qry_empresa.Open;

  frxReportRecibo.ShowReport;
end;

procedure TfrmRecibos.actIncluirExecute(Sender: TObject);
begin
  try
    if frmRecibosE = nil then
      frmRecibosE      := TfrmRecibosE.Create(application);

    frmRecibosE.p_operacao := utipos.OpIncluir;
    frmRecibosE.codigo := -1;
    frmRecibosE.ShowModal;

  finally
    freeandnil(frmRecibosE);
  end;
end;

procedure TfrmRecibos.FormCreate(Sender: TObject);
begin
  inherited;
  qryImagemRelatorio.Connection := conexao;
  qryImagemRelatorio.Open;
end;

end.
